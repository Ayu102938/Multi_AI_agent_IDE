# プロジェクトコンテキスト概要 (更新日: 2026-02-19)

## 📌 概要
**Multi-Agent IDE** は、複数のAIエージェント（Architect, Coder, Testerなど）が協力して、ユーザーの要望に基づいてソフトウェアを構築する、AIを活用した統合開発環境です。

## ✅ 完了したタスク (Phase 1 & 2 + デバッグ)
- **基本インフラ**:
    - バックエンド: FastAPI, CrewAI, API/WebSocket設定
    - フロントエンド: React + Vite, Monaco Editor統合
    - LLM統合: OpenAI, Google Gemini, ZhiPu GLM (LiteLLM経由)
- **エージェント統合**:
    - Architect, Coder, Tester, Librarian エージェントの実装
    - ワークスペース操作用の `FileReadTool` & `FileWriteTool`
- **IDE機能**:
    - **リアルタイム・ファイルエクスプローラー**: 自動更新（5秒間隔ポーリング）
    - **アクティビティログ**: エージェントの思考と行動を表示し、実行中はローディングスピナーを表示
    - **ファイル削除**: UIから直接ファイルを削除可能
    - **ユーザー入力 (標準入力)**: 専用のテキストエリアから `stdin` (Pythonスクリプトの `input()` など) への入力をサポート
    - **サンドボックス実行 (部分的)**: `run_code` エンドポイントによりワークスペース内でPythonコードを実行
    - **レート制限対策**: AI処理中はフロントエンドの「Send」ボタンを無効化し、APIエラーを防止

## 🚧 現在の進捗とステータス
- **Phase 1 (MVP)**: 完了
- **Phase 2 (ファイルI/O)**: 完了
- **Phase 3 (高度な機能)**: 進行中
    - 現在はUXの改善と安定性のデバッグに注力中
- **安定性**:
    - 基本機能は動作するが、無料版LLM (Gemini Flash) を使用する場合、**APIレート制限 (429エラー)** が主要なボトルネックとなっている
    - フロントエンドに保護機能（ボタン無効化）を実装済みだが、根本的なAPI制限は依然として制約事項

## 📝 残りのタスク (ロードマップより)
1. **インタラクティブシェル / ターミナル**:
    - 現在の「ユーザー入力」はリクエストベースの回避策。`while True:` ループのような完全な対話性を実現するには、Websocketベースのリアルタイムターミナルが必要。
2. **プロジェクト管理**:
    - 複数のプロジェクトを作成・切り替える機能（現在は単一ワークスペースのみ）。
3. **サンドボックスセキュリティ**:
    - 現在の `exec()` は安全ではないため、Dockerコンテナなどの隔離環境が必要。
4. **Git連携**:
    - IDEから直接GitHubへコミット・プッシュする機能。
5. **LSP (Language Server Protocol)**:
    - Monaco Editorでのより高度なコード補完とエラーチェック。

## ⚠️ 既知の問題と課題
1. **APIレート制限 (重要)**:
    - エージェントが短時間に多数のリクエストを生成するため、Gemini Free Tierの制限 (429 Resource Exhausted) に達しやすい。
    - **現在の対策**: フロントエンドでの二重送信防止。
    - **将来の対策**: APIプランのアップグレード、またはエージェントチェーンの最適化（例: ArchitectとCoderの統合）。
2. **エージェントのループ**:
    - エージェントが稀に無限ループに陥ったり、過剰な出力を生成してタイムアウトすることがある。
3. **ブロッキング実行**:
    - `run_code` が同期的であるため、長時間実行されるスクリプトはバックエンドワーカーをブロックしてしまう。

## 💡 改善の提案
- **エージェント稼働状況の可視化**: 現在の「Thinking...」だけでなく、**「Architectが思考中」「Coderが実装中」のように、現在稼働しているエージェント名を具体的に表示する** UIへの改善。
- **非同期実行**: `run_code` をバックグラウンドワーカー (Celery/Redis) に移動し、長時間実行をサポートする。
- **Dockerサンドボックス**: `exec()` をDockerコンテナに置き換え、安全かつ堅牢なコード実行環境を実現する。
- **構造化出力**: エージェントの出力を厳密なJSON形式に強制し、パースの信頼性を向上させる。
- **エージェント最適化**: 単純なタスクではArchitectとCoderを統合するなどして、APIコール数を削減する。

---
*新しいセッションを開始する際は、このファイルを読んでプロジェクトの現状を把握してください。*
